# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Points to the root of Google Test, relative to where this file is.
GTEST_DIR = ..

# Where to find user code.
USER_DIR = .

#CXX = arm-poky-linux-gnueabi-g++ 
CXX = g++ 
CC = gcc

#dbus-glib-1 : glib-2.0 dbus-1
INCLUDES := -I../../include
INCLUDES+=$(shell pkg-config dbus-glib-1 --cflags)

LIBS := -lpthread -lrt
#-ldbus-glib-1 -ldbus-1 -lgobject-2.0 -lglib-2.0 
LIBS += $(shell pkg-config dbus-glib-1 --libs)

# created to the list.
TESTS = didata_unittest

#add by rocky
FILES = $(foreach d, $(USER_DIR), $(wildcard $(d)/*.cpp))
OBJS := $(patsubst %.cpp, %.o, $(FILES))

# no all C file is usefull,so we cannot define OBJS like the following
#FILES = $(foreach d, $(USER_DIR), $(wildcard $(d)/*.c))
#OBJS += $(patsubst %.c, %.o, $(FILES))
OBJS += popup.o
OBJS += popup_msg.o
OBJS += popup_on.o
OBJS += popup_priority.o
OBJS += main.o
OBJS += table.o
OBJS += special.o
OBJS += general.o
OBJS += timer.o
OBJS += reset.o
OBJS += speed_power_doors.o
OBJS += util.o
OBJS += flash_timer.o

#all : $(TESTS)
all : $(OBJS)


.PHONY:clean
clean:
	rm -f $(TESTS) *.o

%.o : %.c
	$(CC) $(CPPFLAGS) $(CFLAGS) $(INCLUDES) -c $< -o $@ 

%.o : %.cpp
	#$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(INCLUDES) $(LIBS) -c $< -o $@ 
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(INCLUDES) -c $< -o $@ 

$(TESTS) : $(OBJS)
	$(CXX) $^ $(LIBS) -fPIC -o $@ -lgcov 

